<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zero Maze</title>
    <style>
        :root {
            --cell-size: 28px;
            --wall-color: #8B4513;
            --path-color: #F8F9FA;
            --accent-color: #D2691E;
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #E0E0E0;
            color: #2F4F4F;
            touch-action: none;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }

        .maze-container {
            width: 100vmin;
            height: 100vmin;
            max-width: 512px;
            max-height: 512px;
            position: relative;
            border: 4px solid var(--accent-color);
            border-radius: 8px;
            overflow: hidden;
            background: #FFFFFF;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .maze {
            display: grid;
            gap: 1px;
            width: 100%;
            height: 100%;
        }

        .cell {
            position: relative;
            background: var(--path-color);
        }

        .wall {
            background: var(--wall-color);
            box-shadow: 0 0 4px rgba(139,69,19,0.3);
        }

        .player {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%232E8B57'/%3E%3Cpath d='M16 4a12 12 0 0 1 0 24 12 12 0 0 1 0-24z' fill='%23FFFFFF'/%3E%3C/svg%3E") center/cover;
            transition: transform 0.15s ease-in-out;
        }

        .end {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23FF4500' d='M16 4l12 24H4z'/%3E%3Ccircle cx='16' cy='22' r='4' fill='%23FFFFFF'/%3E%3C/svg%3E") center/cover;
        }

        .controls {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: #FFFFFF;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .arrow-btn {
            width: 64px;
            height: 64px;
            background: #FFFFFF;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            color: var(--accent-color);
            font-size: 24px;
            font-weight: bold;
            touch-action: manipulation;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrow-btn:active {
            background: #F0F0F0;
            transform: scale(0.92);
        }

        #up { grid-area: up; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; }

        .score-board {
            display: flex;
            gap: 30px;
            font-size: 1.3em;
            margin-bottom: 15px;
            background: #FFFFFF;
            padding: 12px 24px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 30px;
            border: 3px solid var(--accent-color);
            border-radius: 15px;
            text-align: center;
            z-index: 100;
            display: none;
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score-board">
            <div>Điểm: <span id="score">0</span></div>
            <div>Bước còn lại: <span id="steps">100</span></div>
        </div>
        
        <div class="maze-container">
            <div class="maze" id="maze"></div>
        </div>

        <div class="controls">
            <button class="arrow-btn" id="up">↑</button>
            <button class="arrow-btn" id="left">←</button>
            <button class="arrow-btn" id="right">→</button>
            <button class="arrow-btn" id="down">↓</button>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <h2 id="resultTitle"></h2>
        <p id="resultText"></p>
        <button onclick="generateMaze()">Chơi lại</button>
    </div>

    <audio id="moveSound">
        <source src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQIAAP4BAAD//wAA//+AgP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8=" type="audio/wav">
    </audio>

    <script>
        let mazeSize = 15;
        let mazeLayout = [];
        let playerPosition = { x: 1, y: 1 };
        let score = 0;
        let maxSteps = 100;
        let isMoving = false;
        const moveSound = document.getElementById('moveSound');

        function generateMaze() {
            document.getElementById('resultModal').style.display = 'none';
            mazeSize = Math.min(Math.max(15, 5), 25);
            mazeLayout = createRandomMaze(mazeSize);
            renderMaze(mazeLayout);
            resetGame();
        }

        function createRandomMaze(size) {
            size = size % 2 === 0 ? size + 1 : size;
            const maze = Array.from({ length: size }, () => Array(size).fill(1));
            
            function carve(x, y) {
                const dirs = [[1,0],[-1,0],[0,1],[0,-1]].sort(() => Math.random()-0.5);
                maze[y][x] = 0;
                
                for(const [dx, dy] of dirs) {
                    const nx = x + dx*2;
                    const ny = y + dy*2;
                    if(nx > 0 && nx < size-1 && ny > 0 && ny < size-1 && maze[ny][nx]) {
                        maze[y+dy][x+dx] = 0;
                        carve(nx, ny);
                    }
                }
            }
            
            carve(1, 1);
            maze[size-2][size-2] = 0;
            return maze;
        }

        function renderMaze(maze) {
            const mazeElement = document.getElementById('maze');
            mazeElement.innerHTML = '';
            mazeElement.style.gridTemplateColumns = `repeat(${maze.length}, 1fr)`;
            
            const fragment = document.createDocumentFragment();
            
            maze.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = 'cell' + (cell ? ' wall' : '');
                    if(x === 1 && y === 1) div.classList.add('player');
                    if(x === maze.length-2 && y === maze.length-2) div.classList.add('end');
                    fragment.appendChild(div);
                });
            });
            
            mazeElement.appendChild(fragment);
        }

        function resetGame() {
            playerPosition = { x: 1, y: 1 };
            score = 0;
            maxSteps = mazeSize * 7;
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('steps').textContent = maxSteps;
            document.querySelectorAll('.player').forEach(c => c.classList.remove('player'));
            document.querySelector(`#maze .cell:nth-child(${playerPosition.y * mazeSize + playerPosition.x + 1})`).classList.add('player');
        }

        function movePlayer(dx, dy) {
            if(isMoving || maxSteps <= 0) return;
            isMoving = true;
            
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;
            
            if(mazeLayout[newY]?.[newX] === 0) {
                playerPosition = { x: newX, y: newY };
                score++;
                maxSteps--;
                moveSound.currentTime = 0;
                moveSound.play();
                updateDisplay();
                
                if(newX === mazeSize-2 && newY === mazeSize-2) {
                    showResult(`Điểm số: ${score}`, true);
                } else if(maxSteps <= 0) {
                    showResult("Hết bước! Thử lại nhé!", false);
                }
            }
            
            setTimeout(() => isMoving = false, 100);
        }

        function showResult(text, isWin) {
            const modal = document.getElementById('resultModal');
            modal.style.display = 'block';
            modal.style.backgroundColor = isWin ? '#F0FFF0' : '#FFF0F0';
            document.getElementById('resultTitle').textContent = isWin ? "🏆 Chiến thắng!" : "💔 Thua rồi";
            document.getElementById('resultText').textContent = text;
        }

        // Điều khiển
        const controls = {
            up: [0, -1], left: [-1, 0],
            right: [1, 0], down: [0, 1]
        };

        Object.entries(controls).forEach(([id, dir]) => {
            document.getElementById(id).addEventListener('click', () => movePlayer(...dir));
        });

        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': controls.up,
                'ArrowLeft': controls.left,
                'ArrowRight': controls.right,
                'ArrowDown': controls.down
            };
            if(keyMap[e.key]) movePlayer(...keyMap[e.key]);
        });

        // Khởi tạo game
        generateMaze();
    </script>
</body>
</html>
