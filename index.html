<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Game - SVG Edition</title>
    <style>
        :root {
            --cell-size: min(6vw, 40px);
            --wall-color: #6d4c41;
            --path-color: #fff3e0;
        }

        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #efebe9;
            touch-action: none;
        }

        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .maze-container {
            width: 90vw;
            max-width: 600px;
            overflow: auto;
            padding: 10px;
            background: #d7ccc8;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .maze {
            display: grid;
            gap: 2px;
            margin: auto;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            position: relative;
            background-size: cover;
        }

        .wall {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 2h28v28H2z' fill='%236d4c41'/%3E%3Cpath d='M4 4h4v4H4zM12 4h4v4h-4zM20 4h4v4h-4zM28 4h4v4h-4zM4 12h4v4H4zM12 12h4v4h-4zM20 12h4v4h-4zM28 12h4v4h-4z' fill='%235d4037'/%3E%3C/svg%3E");
        }

        .player {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%2342a5f5'/%3E%3Ccircle cx='16' cy='12' r='4' fill='%23fff'/%3E%3Cpath d='M16 20a8 8 0 0 1 8 8H8a8 8 0 0 1 8-8z' fill='%23fff'/%3E%3C/svg%3E");
        }

        .start { background-color: #a5d6a7; }
        .end { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23ef5350'/%3E%3Cpath d='M14 8l12 16-12-4 12-4z' fill='%23fff'/%3E%3C/svg%3E"); }

        .arrow-keys {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 8px;
            margin: 20px 0;
        }

        .arrow-btn {
            width: calc(var(--cell-size) * 2);
            height: calc(var(--cell-size) * 2);
            background: #fff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #757575;
        }

        .arrow-btn:active {
            transform: scale(0.95);
            background: #eee;
        }

        @media (max-width: 600px) {
            :root {
                --cell-size: 8vw;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="size">Kích thước:</label>
        <input type="number" id="size" min="5" max="30" value="10">
        <button onclick="generateMaze()">Tạo mới</button>
    </div>
    
    <div class="maze-container">
        <div class="maze" id="maze"></div>
    </div>

    <div class="arrow-keys">
        <button class="arrow-btn" id="up">↑</button>
        <button class="arrow-btn" id="left">←</button>
        <button class="arrow-btn" id="right">→</button>
        <button class="arrow-btn" id="down">↓</button>
    </div>

    <script>
        let mazeSize = 10;
        let mazeLayout = [];
        let playerPosition = { x: 1, y: 1 };
        let isMoving = false;

        function generateMaze() {
            mazeSize = parseInt(document.getElementById('size').value);
            if (mazeSize < 5 || mazeSize > 30) {
                alert("Kích thước từ 5 đến 30!");
                return;
            }
            
            mazeLayout = createRandomMaze(mazeSize);
            renderMaze(mazeLayout);
            placePlayer();
        }

        function createRandomMaze(size) {
            const maze = Array.from({ length: size }, () => Array(size).fill(1));
            
            function dfs(x, y) {
                const dirs = [[1,0],[-1,0],[0,1],[0,-1]].sort(() => Math.random()-0.5);
                maze[y][x] = 0;
                
                for(const [dx, dy] of dirs) {
                    const nx = x + dx*2;
                    const ny = y + dy*2;
                    if(nx >= 0 && nx < size && ny >= 0 && ny < size && maze[ny][nx]) {
                        maze[y+dy][x+dx] = 0;
                        dfs(nx, ny);
                    }
                }
            }
            
            dfs(1, 1);
            maze[1][1] = 0;
            maze[size-2][size-2] = 0;
            return maze;
        }

        function renderMaze(maze) {
            const mazeElement = document.getElementById('maze');
            mazeElement.innerHTML = '';
            mazeElement.style.gridTemplateColumns = `repeat(${mazeSize}, var(--cell-size))`;
            
            for(let y = 0; y < mazeSize; y++) {
                for(let x = 0; x < mazeSize; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    if(maze[y][x] === 1) cell.classList.add('wall');
                    if(x === 1 && y === 1) cell.classList.add('start');
                    if(x === mazeSize-2 && y === mazeSize-2) cell.classList.add('end');
                    
                    mazeElement.appendChild(cell);
                }
            }
        }

        function placePlayer() {
            playerPosition = { x: 1, y: 1 };
            updatePlayerPosition();
        }

        function updatePlayerPosition() {
            document.querySelectorAll('.player').forEach(c => c.classList.remove('player'));
            const index = playerPosition.y * mazeSize + playerPosition.x;
            document.querySelector(`#maze .cell:nth-child(${index + 1})`).classList.add('player');
        }

        function movePlayer(dx, dy) {
            if(isMoving) return;
            isMoving = true;
            
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;
            
            if(newX >= 0 && newX < mazeSize && 
               newY >= 0 && newY < mazeSize &&
               !mazeLayout[newY][newX]) {
                playerPosition.x = newX;
                playerPosition.y = newY;
                updatePlayerPosition();
                
                if(newX === mazeSize-2 && newY === mazeSize-2) {
                    setTimeout(() => {
                        alert("Chiến thắng!");
                        generateMaze();
                    }, 100);
                }
            }
            
            setTimeout(() => isMoving = false, 150);
        }

        // Touch và mouse controls
        const arrows = {
            up: [0, -1],
            left: [-1, 0],
            right: [1, 0],
            down: [0, 1]
        };

        Object.keys(arrows).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                movePlayer(...arrows[id]);
            });
            btn.addEventListener('mousedown', () => movePlayer(...arrows[id]));
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp': movePlayer(0, -1); break;
                case 'ArrowLeft': movePlayer(-1, 0); break;
                case 'ArrowRight': movePlayer(1, 0); break;
                case 'ArrowDown': movePlayer(0, 1); break;
            }
        });

        // Khởi tạo game
        generateMaze();
    </script>
</body>
</html>
