<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pac-Maze Game</title>
    <style>
        :root {
            --cell-size: 28px;
            --wall-color: #0000AA;
            --path-color: #000000;
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #000;
            color: #FFF;
            touch-action: none;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }

        .maze-container {
            width: 100vmin;
            height: 100vmin;
            max-width: 512px;
            max-height: 512px;
            position: relative;
            border: 4px solid #FFD700;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
        }

        .maze {
            display: grid;
            gap: 1px;
            width: 100%;
            height: 100%;
        }

        .cell {
            position: relative;
            background: var(--path-color);
        }

        .wall {
            background: var(--wall-color);
            box-shadow: 0 0 8px #0000FF;
        }

        .player {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23FFD700'/%3E%3Cpath d='M16 4a12 12 0 0 1 0 24 12 12 0 0 1 0-24z' fill='%23FFF'/%3E%3C/svg%3E") center/cover;
            transition: transform 0.15s ease-in-out;
        }

        .end {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='12' fill='%2300FF00'/%3E%3Ccircle cx='16' cy='16' r='6' fill='%23FFFFFF'/%3E%3C/svg%3E") center/cover;
        }

        .controls {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 10px;
            margin: 20px 0;
        }

        .arrow-btn {
            width: 60px;
            height: 60px;
            background: #333;
            border: 2px solid #FFD700;
            border-radius: 50%;
            color: #FFD700;
            font-size: 24px;
            touch-action: manipulation;
            transition: all 0.1s;
        }

        .arrow-btn:active {
            background: #555;
            transform: scale(0.9);
        }

        #up { grid-area: up; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; }

        .score-board {
            display: flex;
            gap: 20px;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000;
            padding: 20px;
            border: 3px solid #FFD700;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score-board">
            <div>ƒêi·ªÉm: <span id="score">0</span></div>
            <div>B∆∞·ªõc c√≤n l·∫°i: <span id="steps">100</span></div>
        </div>
        
        <div class="maze-container">
            <div class="maze" id="maze"></div>
        </div>

        <div class="controls">
            <button class="arrow-btn" id="up">‚Üë</button>
            <button class="arrow-btn" id="left">‚Üê</button>
            <button class="arrow-btn" id="right">‚Üí</button>
            <button class="arrow-btn" id="down">‚Üì</button>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <h2 id="resultTitle"></h2>
        <p id="resultText"></p>
        <button onclick="generateMaze()">Ch∆°i l·∫°i</button>
    </div>

    <script>
        let mazeSize = 15;
        let mazeLayout = [];
        let playerPosition = { x: 1, y: 1 };
        let score = 0;
        let maxSteps = 100;
        let isMoving = false;

        function generateMaze() {
            document.getElementById('resultModal').style.display = 'none';
            mazeSize = Math.min(Math.max(parseInt(document.getElementById('size')?.value || 15), 5), 25);
            mazeLayout = createRandomMaze(mazeSize);
            renderMaze(mazeLayout);
            resetGame();
        }

        function createRandomMaze(size) {
            size = size % 2 === 0 ? size + 1 : size;
            const maze = Array.from({ length: size }, () => Array(size).fill(1));
            
            function carve(x, y) {
                const dirs = [[1,0],[-1,0],[0,1],[0,-1]].sort(() => Math.random()-0.5);
                maze[y][x] = 0;
                
                for(const [dx, dy] of dirs) {
                    const nx = x + dx*2;
                    const ny = y + dy*2;
                    if(nx > 0 && nx < size-1 && ny > 0 && ny < size-1 && maze[ny][nx]) {
                        maze[y+dy][x+dx] = 0;
                        carve(nx, ny);
                    }
                }
            }
            
            carve(1, 1);
            maze[size-2][size-2] = 0;
            return maze;
        }

        function renderMaze(maze) {
            const mazeElement = document.getElementById('maze');
            mazeElement.innerHTML = '';
            mazeElement.style.gridTemplateColumns = `repeat(${maze.length}, 1fr)`;
            
            const fragment = document.createDocumentFragment();
            
            maze.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = 'cell' + (cell ? ' wall' : '');
                    if(x === 1 && y === 1) div.classList.add('player');
                    if(x === maze.length-2 && y === maze.length-2) div.classList.add('end');
                    fragment.appendChild(div);
                });
            });
            
            mazeElement.appendChild(fragment);
        }

        function resetGame() {
            playerPosition = { x: 1, y: 1 };
            score = 0;
            maxSteps = mazeSize * 7;
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('steps').textContent = maxSteps;
            document.querySelectorAll('.player').forEach(c => c.classList.remove('player'));
            document.querySelector(`#maze .cell:nth-child(${playerPosition.y * mazeSize + playerPosition.x + 1})`).classList.add('player');
        }

        function movePlayer(dx, dy) {
            if(isMoving || maxSteps <= 0) return;
            isMoving = true;
            
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;
            
            if(mazeLayout[newY]?.[newX] === 0) {
                playerPosition = { x: newX, y: newY };
                score++;
                maxSteps--;
                updateDisplay();
                
                if(newX === mazeSize-2 && newY === mazeSize-2) {
                    showResult(`Chi·∫øn th·∫Øng! ƒêi·ªÉm: ${score}`, true);
                } else if(maxSteps <= 0) {
                    showResult("H·∫øt b∆∞·ªõc! Thua cu·ªôc", false);
                }
            }
            
            setTimeout(() => isMoving = false, 100);
        }

        function showResult(text, isWin) {
            const modal = document.getElementById('resultModal');
            modal.style.display = 'block';
            modal.style.backgroundColor = isWin ? '#002200' : '#220000';
            document.getElementById('resultTitle').textContent = isWin ? "üéâ Chi·∫øn th·∫Øng!" : "üòû Th·∫•t b·∫°i";
            document.getElementById('resultText').textContent = text;
        }

        // ƒêi·ªÅu khi·ªÉn
        const controls = {
            up: [0, -1], left: [-1, 0],
            right: [1, 0], down: [0, 1]
        };

        Object.entries(controls).forEach(([id, dir]) => {
            document.getElementById(id).addEventListener('click', () => movePlayer(...dir));
        });

        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': controls.up,
                'ArrowLeft': controls.left,
                'ArrowRight': controls.right,
                'ArrowDown': controls.down
            };
            if(keyMap[e.key]) movePlayer(...keyMap[e.key]);
        });

        // Kh·ªüi t·∫°o game
        generateMaze();
    </script>
</body>
</html>
