<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zero Maze</title>
    <style>
        :root {
            --cell-size: 28px;
            --wall-color: #8B4513;
            --path-color: #F8F9FA;
            --accent-color: #6CB4EE;
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #E0E0E0;
            color: #2F4F4F;
            touch-action: none;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            width: 90%;
        }

        .maze-container {
            width: 90vmin;
            height: 90vmin;
            max-width: 512px;
            max-height: 512px;
            margin: 0 auto;
            position: relative;
            border: 4px solid var(--accent-color);
            border-radius: 8px;
            overflow: hidden;
            background: #FFFFFF;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .maze {
            display: grid;
            gap: 1px;
            width: 100%;
            height: 100%;
        }

        .cell {
            position: relative;
            background: var(--path-color);
        }

        .wall {
            background: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='%238B4513' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%239C6B3A'/%3E%3Cpath d='M0 0 L16 0 L16 1 L0 1 Z M0 7 L16 7 L16 8 L0 8 Z M0 15 L16 15 L16 16 L0 16 Z' fill='%237A5230'/%3E%3C/svg%3E");
        }

        .player {
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='16' cy='11' r='4' fill='%232E8B57'/%3E%3Cpath d='M16 15a9 9 0 0 0-9 9v3h18v-3a9 9 0 0 0-9-9z' fill='%232E8B57'/%3E%3C/svg%3E") center/cover;
            transition: transform 0.15s ease-in-out;
        }

        .end {
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%236CB4EE' d='M16 2L28 18H4z'/%3E%3Ccircle cx='16' cy='18' r='4' fill='%23FFF'/%3E%3C/svg%3E") center/cover;
        }

        .controls {
            display: grid;
            grid-template-areas: 
                "up up up"
                "left . right"
                "down down down";
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #FFFFFF;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .arrow-btn {
            width: 48px;
            height: 48px;
            background: #FFFFFF;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            color: var(--accent-color);
            font-size: 20px;
            font-weight: bold;
            touch-action: manipulation;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #up { grid-area: up; justify-self: center; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; justify-self: center; }

        .score-board {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 1.2em;
            margin-bottom: 15px;
            background: #FFFFFF;
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 400px;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 30px;
            border: 3px solid var(--accent-color);
            border-radius: 15px;
            text-align: center;
            z-index: 100;
            display: none;
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        #startModal {
            display: block;
        }

        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
        }

        input[type="text"] {
            padding: 8px;
            margin: 10px;
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            width: 200px;
            required: true;
        }

        .slider-container {
            margin: 15px 0;
            width: 250px;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 15px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="modal" id="startModal">
        <h2>Chào mừng!</h2>
        <input type="text" id="playerName" placeholder="Tên người chơi*" required>
        <div class="slider-container">
            <input type="range" min="11" max="27" step="8" value="11" class="slider" id="difficulty">
            <div>Độ khó: <span id="difficultyValue">11x11 (Dễ)</span></div>
        </div>
        <button onclick="startGame()">Bắt đầu</button>
    </div>

    <div class="game-container" style="display:none">
        <button class="back-btn" onclick="backToMenu()">↩ Quay lại</button>
        <div class="score-board">
            <div>Người chơi: <strong id="currentPlayer"></strong></div>
            <div>Bước đã đi: <span id="steps">0</span></div>
            <div>Bước còn lại: <span id="remainingSteps">100</span></div>
        </div>
        
        <div class="maze-container">
            <div class="maze" id="maze"></div>
        </div>

        <div class="controls">
            <button class="arrow-btn" id="up">↑</button>
            <button class="arrow-btn" id="left">←</button>
            <button class="arrow-btn" id="right">→</button>
            <button class="arrow-btn" id="down">↓</button>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <h2 id="resultTitle"></h2>
        <p id="playerResult"></p>
        <p id="resultText"></p>
        <p>Bước sử dụng: <span id="finalSteps"></span></p>
        <button onclick="generateMaze()">Chơi lại</button>
    </div>

    <script>
        let mazeSize = 11;
        let mazeLayout = [];
        let playerPosition = { x: 1, y: 1 };
        let stepCount = 0;
        let maxSteps = 100;
        let isMoving = false;
        let playerName = "";

        // Xử lý slider
        const slider = document.getElementById("difficulty");
        const difficultyValue = document.getElementById("difficultyValue");
        slider.oninput = function() {
            mazeSize = this.value;
            difficultyValue.textContent = `${this.value}x${this.value} (${
                this.value == 11 ? "Dễ" : this.value == 19 ? "Thường" : "Khó"
            })`;
        }

        function startGame() {
            if(!document.getElementById('playerName').value) {
                alert("Vui lòng nhập tên người chơi!");
                return;
            }
            playerName = document.getElementById('playerName').value;
            document.getElementById('startModal').style.display = 'none';
            document.querySelector('.game-container').style.display = 'flex';
            document.getElementById('currentPlayer').textContent = playerName;
            generateMaze();
        }

        function backToMenu() {
            document.querySelector('.game-container').style.display = 'none';
            document.getElementById('startModal').style.display = 'block';
        }

        function generateMaze() {
            document.getElementById('resultModal').style.display = 'none';
            mazeLayout = createRandomMaze(mazeSize);
            renderMaze(mazeLayout);
            resetGame();
        }

        function createRandomMaze(size) {
            size = size % 2 === 0 ? size + 1 : size;
            const maze = Array.from({ length: size }, () => Array(size).fill(1));
            
            function carve(x, y) {
                const dirs = [[1,0],[-1,0],[0,1],[0,-1]].sort(() => Math.random()-0.5);
                maze[y][x] = 0;
                
                for(const [dx, dy] of dirs) {
                    const nx = x + dx*2;
                    const ny = y + dy*2;
                    if(nx > 0 && nx < size-1 && ny > 0 && ny < size-1 && maze[ny][nx]) {
                        maze[y+dy][x+dx] = 0;
                        carve(nx, ny);
                    }
                }
            }
            
            carve(1, 1);
            maze[size-2][size-2] = 0;
            return maze;
        }

        function renderMaze(maze) {
            const mazeElement = document.getElementById('maze');
            mazeElement.innerHTML = '';
            mazeElement.style.gridTemplateColumns = `repeat(${maze.length}, 1fr)`;
            
            const fragment = document.createDocumentFragment();
            
            maze.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = 'cell' + (cell ? ' wall' : '');
                    if(x === 1 && y === 1) div.classList.add('player');
                    if(x === maze.length-2 && y === maze.length-2) div.classList.add('end');
                    fragment.appendChild(div);
                });
            });
            
            mazeElement.appendChild(fragment);
        }

        function resetGame() {
            playerPosition = { x: 1, y: 1 };
            stepCount = 0;
            maxSteps = mazeSize * (mazeSize <= 11 ? 10 : mazeSize <= 19 ? 7 : 5);
            document.getElementById('remainingSteps').textContent = maxSteps;
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('steps').textContent = stepCount;
            document.getElementById('remainingSteps').textContent = maxSteps - stepCount;
            document.querySelectorAll('.player').forEach(c => c.classList.remove('player'));
            document.querySelector(`#maze .cell:nth-child(${playerPosition.y * mazeSize + playerPosition.x + 1})`).classList.add('player');
        }

        function movePlayer(dx, dy) {
            if(isMoving || stepCount >= maxSteps) return;
            isMoving = true;
            
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;
            
            if(mazeLayout[newY]?.[newX] === 0) {
                playerPosition = { x: newX, y: newY };
                stepCount++;
                updateDisplay();
                
                if(newX === mazeSize-2 && newY === mazeSize-2) {
                    showResult(`🏁 Hoàn thành trong ${stepCount} bước`, true);
                } else if(stepCount >= maxSteps) {
                    showResult("⏳ Hết bước! Thử lại nhé!", false);
                }
            }
            
            setTimeout(() => isMoving = false, 100);
        }

        function showResult(text, isWin) {
            const modal = document.getElementById('resultModal');
            modal.style.display = 'block';
            modal.style.backgroundColor = isWin ? '#F0FFF0' : '#FFF0F0';
            document.getElementById('resultTitle').textContent = isWin ? "🏆 Chiến thắng!" : "💔 Thua rồi";
            document.getElementById('playerResult').innerHTML = `${playerName} ${isWin ? '🎉' : '😢'}`;
            document.getElementById('resultText').textContent = text;
            document.getElementById('finalSteps').textContent = stepCount;
        }

        // Điều khiển
        const controls = {
            up: [0, -1], left: [-1, 0],
            right: [1, 0], down: [0, 1]
        };

        Object.entries(controls).forEach(([id, dir]) => {
            document.getElementById(id).addEventListener('click', () => movePlayer(...dir));
        });

        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': controls.up,
                'ArrowLeft': controls.left,
                'ArrowRight': controls.right,
                'ArrowDown': controls.down
            };
            if(keyMap[e.key]) movePlayer(...keyMap[e.key]);
        });
    </script>
</body>
</html>
